### PHẦN 1: TÀI LIỆU KỸ THUẬT (SRS) CHO TICKET [BE-08]

#### **Ticket: [BE-08] Add Member to Apartment (Thêm người vào hộ)**

**1. Thông tin chung**

* **Assignee:** Backend Dev
* **Branch Name:** `feature/BE-08-add-member`
* **Estimated Time:** 2h

**2. Mô tả (Description)**
API thêm một nhân khẩu vào một căn hộ với vai trò cụ thể (Chủ hộ hoặc Thành viên).

**3. Yêu cầu kỹ thuật (Technical Specs)**

*   **Endpoint:** `POST /api/apartments/:id/members`
*   **Payload:**
    ```json
    {
      "residentId": "resident_object_id",
      "role": "Thành viên" // hoặc "Chủ hộ"
    }
    ```
*   **Logic:** Update 2 collection tuần tự.
    1.  Validate `residentId` và `apartmentId` (MongoDB ObjectId format).
    2.  Kiểm tra resident đã thuộc căn hộ khác chưa (nếu có và khác `:id` -> Error 400).
    3.  Nếu `role` là 'Chủ hộ', kiểm tra căn hộ đã có ownerId chưa (nếu có và khác `residentId` -> Error 400).
    4.  Update `Residents`: Set `apartmentId` = `:id`, `roleInApartment` = payload.role.
    5.  Update `Apartments`: Push `residentId` vào mảng `members` (nếu chưa có). Nếu role là Chủ hộ, update `ownerId`.

**4. Acceptance Criteria (Tiêu chí chấp nhận)**

* [x] **Owner Check:** Nếu `role` là 'Chủ hộ', kiểm tra xem căn hộ này đã có chủ hộ chưa. Nếu có rồi và khác `residentId` -> Trả về lỗi 400 (Một hộ chỉ có 1 chủ hộ).
* [x] **Consistency:** Dữ liệu phải được cập nhật đồng bộ ở cả 2 bảng `Residents` và `Apartments`.
* [x] **Validation:** Kiểm tra `residentId` và `apartmentId` hợp lệ (MongoDB ObjectId format). Kiểm tra resident đã thuộc căn hộ khác chưa.
* [x] **Response:** Trả về status 200 với message thành công và thông tin đã cập nhật.
